import{i as k,a as D,_ as w,r as v,o as r,c as m,d as t,bf as i,b as p,bt as O,aO as f,ao as x,as as n,m as F,F as S,b3 as A,an as T,w as C}from"./dateFormat-6766bd6f.js";import{a as N}from"./statusTextFormat-746565ff.js";import{g as B}from"./ActivityStore-7cef511e.js";import{M as L}from"./MemberStore-6585b4c4.js";import{S as R}from"./SearchListBar-0e82470f.js";import{M as $}from"./bootstrap.esm-e2f1acc9.js";import{i as V,r as j,a as I,t as P,b as q,c as z,S as U}from"./VueStarRating.common-0e75196f.js";import{l as E}from"./runtime-dom.esm-bundler-82de7fb5.js";import{O as G}from"./OrderStore-4de81e78.js";import{N as H}from"./NoData-0eb11de5.js";import"./axiosBase-91228d64.js";import"./vee-validate.esm-8ceb177b.js";import"./formSchema-19c1282a.js";import"./vue.runtime.esm-bundler-2834e5db.js";const J={data(){return{dateFormat:k,increment:V,readOnly:j,showRating:I,textClass:P,activeColor:q,inactiveColor:z,modal:null,comment:{score:0,content:""},isLoading:!1}},props:{activity:{type:Object,required:!1}},expose:["openModal"],components:{StarRating:U},watch:{activity(){this.setDefaultCurrentComment()}},mounted(){this.modal=new $(this.$refs.modal,{keyboard:!1,backdrop:"static"}),this.setDefaultCurrentComment()},methods:{...D(L,["addComment"]),setDefaultCurrentComment(){const{comment:a}=this.activity;this.comment={score:a?a.score:0,content:a?a.content:""}},openModal(){this.modal.show()},onSubmit(){this.isLoading=!0;const a=this.activity.id;this.addComment({...this.comment,activityId:a}).then(c=>{this.modal.hide(),this.isLoading=!1})}}},K={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},Q={class:"modal-dialog"},W={class:"modal-content"},X={class:"modal-header"},Y={class:"modal-title"},Z=["disabled"],tt={class:"modal-body py-2"},st={class:"list-group list-group-flush p-0"},ot={class:"list-group-item px-0"},et={class:"list-unstyled lh-sm"},it={class:"mb-2"},at=t("small",{class:"opacity-75"},"活動名稱",-1),ct={class:"fw-bold fs-5 text-primary"},nt={class:"mb-2"},lt=t("small",{class:"opacity-75"},"活動地點",-1),dt={class:"d-block"},rt={class:"mb-2"},mt=t("small",{class:"opacity-75"},"活動日期",-1),_t={class:"d-block font-barlow"},ht={class:"mb-2"},ut=t("small",{class:"opacity-75"},"主揪人",-1),bt={class:"d-block"},yt={class:"list-group-item px-0"},vt={class:"mb-2"},pt={class:"mb-3"},gt=["disabled"],ft=t("span",{class:"invalid-feedback"},"必填欄位",-1),xt={class:"modal-footer"},Mt=["disabled"],St=["disabled"],kt={key:0,class:"spinner-border spinner-border-sm",role:"status"};function wt(a,c,e,h,s,l){var _,u,b;const y=v("StarRating");return r(),m("div",K,[t("div",Q,[t("div",W,[t("div",X,[t("h5",Y,i(e.activity.comment?"查看":"新增")+"評論",1),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,Z)]),t("div",tt,[t("ul",st,[t("li",ot,[t("ul",et,[t("li",it,[at,t("h1",ct,i(e.activity.title),1)]),t("li",nt,[lt,t("span",dt,i((_=e.activity.location)==null?void 0:_.name),1)]),t("li",rt,[mt,t("span",_t,i(`${s.dateFormat(e.activity.startDate)} ~ ${s.dateFormat(e.activity.endDate)}`),1)]),t("li",ht,[ut,t("span",bt,i((u=e.activity.user)==null?void 0:u.name),1)])])]),t("li",yt,[t("p",vt,"給「"+i((b=e.activity.user)==null?void 0:b.name)+"」一些回饋或鼓勵的話...",1),p(y,{"text-class":s.textClass,increment:s.increment,"star-size":20,"read-only":e.activity.comment?s.readOnly:!1,"show-rating":s.showRating,"active-color":s.activeColor,"inactive-color":s.inactiveColor,rating:s.comment.score,"onUpdate:rating":c[0]||(c[0]=d=>s.comment.score=d)},null,8,["text-class","increment","read-only","show-rating","active-color","inactive-color","rating"])])]),t("div",pt,[O(t("textarea",{class:f(["form-control",{"is-invalid":!s.comment.content}]),rows:"5","onUpdate:modelValue":c[1]||(c[1]=d=>s.comment.content=d),disabled:e.activity.comment},null,10,gt),[[E,s.comment.content,void 0,{trim:!0}]]),ft])]),t("div",xt,[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal",disabled:s.isLoading},i(e.activity.comment?"關閉":"取消"),9,Mt),e.activity.comment?x("",!0):(r(),m("button",{key:0,type:"button",class:"btn btn-primary btn-custom-rectangle",disabled:s.isLoading||!s.comment.content,onClick:c[2]||(c[2]=(...d)=>l.onSubmit&&l.onSubmit(...d))},[s.isLoading?(r(),m("span",kt)):x("",!0),n(" 新增 ")],8,St))])])])],512)}const Ct=w(J,[["render",wt]]),Dt={data(){return{dateFormat:k,modal:null,isLoading:!1}},props:{order:{type:Object,required:!0}},expose:["openModal"],mounted(){this.modal=new $(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{...D(G,["delOrder"]),openModal(){this.modal.show()},onSubmit(){this.isLoading=!0;const{id:a}=this.order;this.delOrder(a).then(c=>{this.modal.hide(),this.isLoading=!1})}}},Lt={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},$t={class:"modal-dialog"},Ot={class:"modal-content"},Ft={class:"modal-header"},At=t("h5",{class:"modal-title"},"刪除報名",-1),Tt=["disabled"],Nt={class:"modal-body"},Bt={class:"list-unstyled lh-sm mb-0"},Rt={class:"mt-2"},Vt=t("small",{class:"opacity-75"},"活動名稱",-1),jt={class:"fw-bold fs-5 text-danger"},It={class:"mt-2"},Pt=t("small",{class:"opacity-75"},"活動地點",-1),qt={class:"d-block"},zt={class:"mt-2"},Ut=t("small",{class:"opacity-75"},"活動日期",-1),Et={class:"d-block font-barlow"},Gt={class:"modal-footer"},Ht=["disabled"],Jt=["disabled"],Kt={key:0,class:"spinner-border spinner-border-sm",role:"status"};function Qt(a,c,e,h,s,l){var y,_,u,b,d,o,g;return r(),m("div",Lt,[t("div",$t,[t("div",Ot,[t("div",Ft,[At,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,Tt)]),t("div",Nt,[n(" 您確認要刪除報名此揪團活動，系統將會釋出您名額給其他潛友報名？ "),t("ul",Bt,[t("li",Rt,[Vt,t("h1",jt,i((y=e.order.activity)==null?void 0:y.title),1)]),t("li",It,[Pt,t("span",qt,i((u=(_=e.order.activity)==null?void 0:_.location)==null?void 0:u.name),1)]),t("li",zt,[Ut,t("span",Et,i(`${s.dateFormat((d=(b=e.order)==null?void 0:b.activity)==null?void 0:d.startDate)} ~ ${s.dateFormat((g=(o=e.order)==null?void 0:o.activity)==null?void 0:g.endDate)}`),1)])])]),t("div",Gt,[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal",disabled:s.isLoading},"取消",8,Ht),t("button",{type:"button",class:"btn btn-danger btn-custom-rectangle",disabled:s.isLoading,onClick:c[0]||(c[0]=(...M)=>l.onSubmit&&l.onSubmit(...M))},[s.isLoading?(r(),m("span",Kt)):x("",!0),n(" 刪除 ")],8,Jt)])])])],512)}const Wt=w(Dt,[["render",Qt]]);const Xt={data(){return{dateFormat:k,activityStatusTextFormat:N,getMainImg:B,filterMyOrders:[],currentActivity:{},currentOrder:{}}},components:{SearchListBar:R,CommentModal:Ct,DeleteOrderModal:Wt,NoData:H},computed:{...F(L,["myOrders"])},watch:{myOrders(){this.filterMyOrders=this.myOrders}},mounted(){this.filterMyOrders=this.myOrders},methods:{getActivityStatusTotal(a){return this.filterMyOrders.reduce((c,e)=>{const{activity:h}=e;return h.activityStatus===a&&c++,c},0)},onSubmit(a){const{keyword:c,startDate:e,endDate:h}=a;this.filterMyOrders=this.myOrders.filter(s=>(!c||s.activity.title.indexOf(c)>-1)&&(!e||s.activity.startDate>=e)&&(!h||h>=s.activity.endDate))},openCommentModal(a){this.currentActivity={...a},this.$refs.childCommentModal.openModal()},openDeleteOrderModal(a){this.currentOrder={...a},this.$refs.childDeleteOrderModal.openModal()}}},Yt={class:"py-3"},Zt={class:"row g-3 align-items-sm-center"},ts={class:"col-md-6 col-xl-4 col-xxl-3 d-flex align-items-center"},ss={class:"custom-rectangle-img custom-rectangle border-card-border-width border flex-shrink-0"},os=["src","alt"],es={class:"ms-2"},is={class:"fw-bold h6 mb-1 text-primary text-truncate-row-2"},as={class:"fs-7 mb-0 text-truncate"},cs={class:"col-md-6 col-xl-3 col-xxl d-flex flex-column justify-content-sm-center align-items-start"},ns=t("small",{class:"order-md-last opacity-80"},"活動日期",-1),ls={class:"font-barlow"},ds={class:"col-6 col-xl col-xxl-2 d-flex flex-column justify-content-sm-center align-items-start"},rs=t("small",{class:"order-md-last opacity-80"},"主揪人",-1),ms={class:"font-barlow"},_s={class:"col-6 col-xl col-xxl-2 d-flex flex-column justify-content-sm-center align-items-start"},hs=t("small",{class:"order-md-last opacity-80"},"活動狀態",-1),us={class:"col-xl-2"},bs={class:"row gx-2 align-items-center"},ys={class:"col-auto"},vs={class:"col-auto"},ps={class:"col-auto"},gs=["onClick","disabled"],fs={class:"col-auto col-xl-12"},xs=["disabled","onClick"],Ms={class:"border-top px-3 pt-2 opacity-80"},Ss={class:"row gx-2 gx-md-3 align-items-center list-unstyled mb-0"},ks={class:"col-md"},ws={class:"me-1 font-barlow"},Cs={class:"me-1 font-barlow"},Ds={class:"col-auto"},Ls={class:"me-1 font-barlow"},$s={class:"col-auto"},Os={class:"me-1 font-barlow"},Fs={class:"col-auto"},As={class:"me-1 font-barlow"};function Ts(a,c,e,h,s,l){const y=v("SearchListBar"),_=v("RouterLink"),u=v("NoData"),b=v("CommentModal"),d=v("DeleteOrderModal");return r(),m(S,null,[t("div",Yt,[p(y,{onOnSubmit:l.onSubmit,class:"pb-3"},null,8,["onOnSubmit"]),s.filterMyOrders.length?(r(!0),m(S,{key:0},A(s.filterMyOrders,(o,g)=>(r(),m("div",{class:f(["p-3",{"bg-lightPrimary bg-opacity-10":(g+1)%2}]),key:o.id},[t("div",Zt,[t("div",ts,[t("div",ss,[t("img",{src:s.getMainImg(o.activity.imgs).img,class:"custom-rectangle img-cover",alt:o.activity.title},null,8,os)]),t("div",es,[t("h2",is,i(o.activity.title),1),t("h3",as,i(o.activity.location.name),1)])]),t("div",cs,[ns,t("span",ls,i(`${s.dateFormat(o.activity.startDate)} ~ ${s.dateFormat(o.activity.endDate)}`),1)]),t("div",ds,[rs,t("span",ms,i(o.activity.user.name),1)]),t("div",_s,[hs,t("span",{class:f({"text-danger":o.activity.activityStatus===0,"opacity-50":o.activity.activityStatus===3})},i(s.activityStatusTextFormat(o.activity.activityStatus)),3)]),t("div",us,[t("div",bs,[t("div",ys,[p(_,{to:`/activity/${o.activity.id}`,class:"btn btn-link btn-sm border-0 p-0"},{default:C(()=>[n("詳情")]),_:2},1032,["to"])]),t("div",vs,[p(_,{to:`/activity/${o.activity.id}#messaget`,class:"btn btn-link btn-sm border-0 p-0"},{default:C(()=>[n("留言")]),_:2},1032,["to"])]),t("div",ps,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",onClick:M=>l.openCommentModal(o.activity),disabled:o.activity.activityStatus===0||o.activity.activityStatus===1},[n(" 評論"),o.activity.comment?(r(),m(S,{key:0},[n("(1)")],64)):x("",!0)],8,gs)]),t("div",fs,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",disabled:o.activity.orderStatus===3||o.activity.orderStatus===0,onClick:M=>l.openDeleteOrderModal(o)}," 刪除報名 ",8,xs)])])])])],2))),128)):(r(),T(u,{key:1,class:"pt-4 pb-5"})),t("div",Ms,[t("ul",Ss,[t("li",ks,[n(" 總計："),t("strong",ws,i(s.filterMyOrders.length),1),n("筆 ")]),t("li",{class:f(["col-auto ms-md-auto",{"text-danger":l.getActivityStatusTotal(0)}])},[n(" 系統中止："),t("strong",Cs,i(l.getActivityStatusTotal(0)),1),n("筆 ")],2),t("li",Ds,[n(" 未開始："),t("strong",Ls,i(l.getActivityStatusTotal(1)),1),n("筆 ")]),t("li",$s,[n(" 進行中："),t("strong",Os,i(l.getActivityStatusTotal(2)),1),n("筆 ")]),t("li",Fs,[n(" 已結束："),t("strong",As,i(l.getActivityStatusTotal(3)),1),n("筆 ")])])])]),p(b,{ref:"childCommentModal",activity:s.currentActivity},null,8,["activity"]),p(d,{ref:"childDeleteOrderModal",order:s.currentOrder},null,8,["order"])],64)}const Ks=w(Xt,[["render",Ts]]);export{Ks as default};
