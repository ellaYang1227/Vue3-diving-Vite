import{f as l}from"./formSchema-ec93e38c.js";import{F as $,a as b,E as p}from"./vee-validate.esm-3e833f9c.js";import{m as V,bv as F,bw as g,L as I,r as M,o,ak as U,w,b as i,a as d,c as r,u as e,ap as f,bd as m,al as u,aL as h,F as v,b1 as k}from"./dateFormat-6fb55f48.js";import{M as T}from"./MemberStore-b4dff722.js";import{O as C}from"./OptionStore-bc442a1c.js";import{_ as S}from"./UploadImg-0531b5fe.js";const q=["disabled"],O={class:"col-12"},D={class:"col-md-6"},R=["for"],x={key:0,class:"text-danger"},B={class:"col-md-6"},E=["for"],j={key:0,class:"text-danger"},z={key:0,class:"invalid-feedback form-help"},A={class:"col-md-6"},K=["for"],P={key:0,class:"text-danger"},G={class:"col-12 border-top pt-3"},H=i("div",{class:"alert alert-warning",role:"alert"}," 警告：請確實勾選您的證照，出團時，須提供證件審查；如有不實，則受退團處分，且不予退費。 ",-1),J={class:"form-label d-block"},Q={key:0,class:"text-danger"},W=["for"],X={class:"col-12"},Y={class:"form-label d-block"},Z={key:0,class:"text-danger"},ee=["for"],le={class:"col-auto"},ae=["for"],se={key:0,class:"text-danger"},ie=i("option",{value:"",disabled:""},"請選擇",-1),te=["value"],oe={class:"col-12 text-end border-top pt-3 mt-4 mt-md-5"},re=["disabled"],de={key:0,class:"spinner-border spinner-border-sm",role:"status"},ne={data(){return{certificateLevels:[],cylinderTotals:[],form:{email:"",password:"",name:"",img:"",certificateLevelId:null,isNitrox:null,cylinderTotalId:""},isLoadingSubmit:!1}},components:{VForm:$,Field:b,ErrorMessage:p,UploadImg:S},computed:{...V(F,["user"]),...V(T,["myinfo"])},watch:{myinfo(){this.setInitialFormData()}},created(){this.$watch(()=>this.$route.params,()=>{const{path:n}=this.$route;(n.indexOf("/signup")>-1||n.indexOf("/editMyinfo")>-1)&&this.fetchData()},{immediate:!0})},methods:{...g(I,["hideLoading"]),...g(C,["getCertificateLevels","getCylinderTotals"]),...g(T,["signup","updateMyinfo"]),fetchData(){Promise.all([this.getCertificateLevels(),this.getCylinderTotals()]).then(n=>{this.certificateLevels=n[0],this.cylinderTotals=n[1],this.setInitialFormData(),this.hideLoading()})},setInitialFormData(){var n,a;this.form={email:"",password:"",name:"",img:"",certificateLevelId:null,isNitrox:null,cylinderTotalId:""},(n=this.user)!=null&&n.id&&((a=this.myinfo)!=null&&a.email)&&Object.keys(this.form).forEach(y=>this.form[y]=this.myinfo[y])},onSubmit(){var n;if(this.isLoadingSubmit=!0,(n=this.user)!=null&&n.id)this.updateMyinfo(this.form).then(a=>this.isLoadingSubmit=!1);else{const{returnUrl:a}=this.$route.query;this.signup(this.form,a).then(t=>this.isLoadingSubmit=!1)}}}},he=Object.assign(ne,{__name:"MyinfoForm",setup(n){return(a,t)=>{const y=M("VForm");return o(),U(y,{onSubmit:a.onSubmit},{default:w(({errors:c})=>{var L,N;return[i("fieldset",{disabled:a.isLoadingSubmit,class:"row g-3"},[i("div",O,[d(S,{errors:c,img:a.form.img,"onUpdate:img":t[0]||(t[0]=s=>a.form.img=s)},null,8,["errors","img"])]),(L=a.user)!=null&&L.id?u("",!0):(o(),r(v,{key:0},[i("div",D,[i("label",{for:e(l).email.name,class:"form-label"},[f(m(e(l).email.label),1),e(l).email.isRequired?(o(),r("span",x,"*")):u("",!0)],8,R),d(e(b),{id:e(l).email.name,name:e(l).email.label,type:e(l).email.type,class:h(["form-control",{"is-invalid":c[e(l).email.label]}]),placeholder:`請輸入 ${e(l).email.label}`,rules:e(l).email.rules,modelValue:a.form.email,"onUpdate:modelValue":t[1]||(t[1]=s=>a.form.email=s),modelModifiers:{trim:!0}},null,8,["id","name","type","class","placeholder","rules","modelValue"]),d(e(p),{name:e(l).email.label,class:"invalid-feedback"},null,8,["name"])]),i("div",B,[i("label",{for:e(l).password.name,class:"form-label"},[f(m(e(l).password.label),1),e(l).password.isRequired?(o(),r("span",j,"*")):u("",!0)],8,E),d(e(b),{id:e(l).password.name,name:e(l).password.label,type:e(l).password.type,class:h(["form-control",{"is-invalid":c[e(l).password.label]}]),placeholder:`請輸入${e(l).password.label}`,rules:e(l).password.rules.full,modelValue:a.form.password,"onUpdate:modelValue":t[2]||(t[2]=s=>a.form.password=s),modelModifiers:{trim:!0}},null,8,["id","name","type","class","placeholder","rules","modelValue"]),d(e(p),{name:e(l).password.label,class:"invalid-feedback"},null,8,["name"]),c[e(l).password.label]?u("",!0):(o(),r("span",z,m(e(l).password.help),1))])],64)),i("div",A,[i("label",{for:e(l).userName.name,class:"form-label"},[f(m(e(l).userName.label),1),e(l).userName.isRequired?(o(),r("span",P,"*")):u("",!0)],8,K),d(e(b),{id:e(l).userName.name,name:e(l).userName.label,type:e(l).userName.type,class:h(["form-control",{"is-invalid":c[e(l).userName.label]}]),placeholder:`請輸入${e(l).userName.label}`,rules:e(l).userName.rules,modelValue:a.form.name,"onUpdate:modelValue":t[3]||(t[3]=s=>a.form.name=s),modelModifiers:{trim:!0}},null,8,["id","name","type","class","placeholder","rules","modelValue"]),d(e(p),{name:e(l).userName.label,class:"invalid-feedback"},null,8,["name"])]),i("div",G,[H,i("label",J,[f(m(e(l).certificateLevel.label),1),e(l).certificateLevel.isRequired?(o(),r("span",Q,"*")):u("",!0)]),(o(!0),r(v,null,k(a.certificateLevels,s=>(o(),r("div",{class:"form-check form-check-inline",key:s.id},[d(e(b),{class:h([{"is-invalid":c[e(l).certificateLevel.label]},"form-check-input"]),id:`${e(l).certificateLevel.name}-${s.id}`,name:e(l).certificateLevel.label,type:e(l).certificateLevel.type,value:s.id,rules:e(l).certificateLevel.rules,modelValue:a.form.certificateLevelId,"onUpdate:modelValue":t[4]||(t[4]=_=>a.form.certificateLevelId=_)},null,8,["class","id","name","type","value","rules","modelValue"]),i("label",{class:"form-check-label",for:`${e(l).certificateLevel.name}-${s.id}`},m(s.name),9,W)]))),128)),d(e(p),{name:e(l).certificateLevel.label,class:"invalid-feedback d-block"},null,8,["name"])]),i("div",X,[i("label",Y,[f(m(e(l).isNitrox.label),1),e(l).isNitrox.isRequired?(o(),r("span",Z,"*")):u("",!0)]),(o(!0),r(v,null,k(e(l).isNitrox.options,s=>(o(),r("div",{class:"form-check form-check-inline",key:s},[d(e(b),{class:h([{"is-invalid":c[e(l).isNitrox.label]},"form-check-input"]),id:`${e(l).isNitrox.name}-${s}`,name:e(l).isNitrox.label,type:e(l).isNitrox.type,value:s,rules:e(l).isNitrox.rules,modelValue:a.form.isNitrox,"onUpdate:modelValue":t[5]||(t[5]=_=>a.form.isNitrox=_)},null,8,["class","id","name","type","value","rules","modelValue"]),i("label",{class:"form-check-label",for:`${e(l).isNitrox.name}-${s}`},m(s?"是":"否"),9,ee)]))),128)),d(e(p),{name:e(l).isNitrox.label,class:"invalid-feedback d-block"},null,8,["name"])]),i("div",le,[i("label",{for:e(l).cylinderTotal.name,class:"form-label d-block"},[f(m(e(l).cylinderTotal.label),1),e(l).cylinderTotal.isRequired?(o(),r("span",se,"*")):u("",!0)],8,ae),d(e(b),{class:h([{"is-invalid":c[e(l).cylinderTotal.label]},"form-select"]),id:e(l).cylinderTotal.name,name:e(l).cylinderTotal.label,as:e(l).cylinderTotal.as,rules:e(l).cylinderTotal.rules,modelValue:a.form.cylinderTotalId,"onUpdate:modelValue":t[6]||(t[6]=s=>a.form.cylinderTotalId=s)},{default:w(()=>[ie,(o(!0),r(v,null,k(a.cylinderTotals,s=>(o(),r("option",{key:s.id,value:s.id},m(s.name),9,te))),128))]),_:2},1032,["class","id","name","as","rules","modelValue"]),d(e(p),{name:e(l).cylinderTotal.label,class:"invalid-feedback"},null,8,["name"])]),i("div",oe,[i("button",{type:"submit",class:"btn btn-primary btn-custom-rectangle",disabled:a.isLoadingSubmit||Object.keys(c).length},[a.isLoadingSubmit?(o(),r("span",de)):u("",!0),f(" "+m((N=a.user)!=null&&N.id?"編輯":"註冊"),1)],8,re)])],8,q)]}),_:1},8,["onSubmit"])}}});export{he as _};
