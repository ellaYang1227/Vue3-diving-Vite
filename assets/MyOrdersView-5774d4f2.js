import{bw as M,o as r,c as m,b as t,bd as a,u as l,g as u,a as _,br as A,aL as b,al as y,ap as i,m as T,F as v,b1 as j,ak as V,r as N,w as f}from"./dateFormat-93a9a041.js";import{a as B}from"./statusTextFormat-746565ff.js";import{g as F}from"./ActivityStore-b38528c5.js";import{M as k}from"./MemberStore-5ddec14d.js";import{_ as w}from"./SearchListBar-ad163a40.js";import{l as P}from"./runtime-dom.esm-bundler-b12ad11b.js";import{S,t as q,i as z,r as I,c as R,a as U,b as E}from"./VueStarRating.common-866da88c.js";import{M as C}from"./bootstrap.esm-e2f1acc9.js";import{O as G}from"./OrderStore-cd098c9b.js";import{N as D}from"./NoData-36c173fb.js";import"./axiosBase-2e8fc5e6.js";import"./formSchema-ec93e38c.js";import"./vee-validate.esm-113c29dc.js";import"./vue.runtime.esm-bundler-f061b126.js";import"./_plugin-vue_export-helper-c27b6911.js";const H={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},J={class:"modal-dialog"},K={class:"modal-content"},Q={class:"modal-header"},W={class:"modal-title"},X=["disabled"],Y={class:"modal-body py-2"},Z={class:"list-group list-group-flush p-0"},tt={class:"list-group-item px-0"},st={class:"list-unstyled lh-sm"},ot={class:"mb-2"},et=t("small",{class:"opacity-75"},"活動名稱",-1),at={class:"fw-bold fs-5 text-primary"},it={class:"mb-2"},nt=t("small",{class:"opacity-75"},"活動地點",-1),lt={class:"d-block"},ct={class:"mb-2"},dt=t("small",{class:"opacity-75"},"活動日期",-1),rt={class:"d-block font-barlow"},mt={class:"mb-2"},ht=t("small",{class:"opacity-75"},"主揪人",-1),_t={class:"d-block"},ut={class:"list-group-item px-0"},bt={class:"mb-2"},yt={class:"mb-3"},vt=["disabled"],pt=t("span",{class:"invalid-feedback"},"必填欄位",-1),gt={class:"modal-footer"},$t=["disabled"],ft=["disabled"],Mt={key:0,class:"spinner-border spinner-border-sm",role:"status"},kt={data(){return{modal:null,comment:{score:0,content:""},isLoading:!1}},props:{activity:{type:Object,required:!1}},expose:["openModal"],components:{StarRating:S},watch:{activity(){this.setDefaultCurrentComment()}},mounted(){this.modal=new C(this.$refs.modal,{keyboard:!1,backdrop:"static"}),this.setDefaultCurrentComment()},methods:{...M(k,["addComment"]),setDefaultCurrentComment(){const{comment:o}=this.activity;this.comment={score:o?o.score:0,content:o?o.content:""}},openModal(){this.modal.show()},onSubmit(){this.isLoading=!0;const o=this.activity.id;this.addComment({...this.comment,activityId:o}).then(s=>{this.modal.hide(),this.isLoading=!1})}}},x=Object.assign(kt,{__name:"CommentModal",setup(o){return(s,n)=>{var c,e,h;return r(),m("div",H,[t("div",J,[t("div",K,[t("div",Q,[t("h5",W,a(o.activity.comment?"查看":"新增")+"評論",1),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,X)]),t("div",Y,[t("ul",Z,[t("li",tt,[t("ul",st,[t("li",ot,[et,t("h1",at,a(o.activity.title),1)]),t("li",it,[nt,t("span",lt,a((c=o.activity.location)==null?void 0:c.name),1)]),t("li",ct,[dt,t("span",rt,a(`${l(u)(o.activity.startDate)} ~ ${l(u)(o.activity.endDate)}`),1)]),t("li",mt,[ht,t("span",_t,a((e=o.activity.user)==null?void 0:e.name),1)])])]),t("li",ut,[t("p",bt,"給「"+a((h=o.activity.user)==null?void 0:h.name)+"」一些回饋或鼓勵的話...",1),_(l(S),{"text-class":l(q),increment:l(z),"star-size":20,"read-only":o.activity.comment?l(I):!1,"show-rating":l(R),"active-color":l(U),"inactive-color":l(E),rating:s.comment.score,"onUpdate:rating":n[0]||(n[0]=d=>s.comment.score=d)},null,8,["text-class","increment","read-only","show-rating","active-color","inactive-color","rating"])])]),t("div",yt,[A(t("textarea",{class:b(["form-control",{"is-invalid":!s.comment.content}]),rows:"5","onUpdate:modelValue":n[1]||(n[1]=d=>s.comment.content=d),disabled:o.activity.comment},null,10,vt),[[P,s.comment.content,void 0,{trim:!0}]]),pt])]),t("div",gt,[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal",disabled:s.isLoading},a(o.activity.comment?"關閉":"取消"),9,$t),o.activity.comment?y("",!0):(r(),m("button",{key:0,type:"button",class:"btn btn-primary btn-custom-rectangle",disabled:s.isLoading||!s.comment.content,onClick:n[2]||(n[2]=(...d)=>s.onSubmit&&s.onSubmit(...d))},[s.isLoading?(r(),m("span",Mt)):y("",!0),i(" 新增 ")],8,ft))])])])],512)}}}),wt={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},St={class:"modal-dialog"},Ct={class:"modal-content"},Dt={class:"modal-header"},xt=t("h5",{class:"modal-title"},"刪除報名",-1),Lt=["disabled"],Ot={class:"modal-body"},At={class:"list-unstyled lh-sm mb-0"},Tt={class:"mt-2"},jt=t("small",{class:"opacity-75"},"活動名稱",-1),Vt={class:"fw-bold fs-5 text-danger"},Nt={class:"mt-2"},Bt=t("small",{class:"opacity-75"},"活動地點",-1),Ft={class:"d-block"},Pt={class:"mt-2"},qt=t("small",{class:"opacity-75"},"活動日期",-1),zt={class:"d-block font-barlow"},It={class:"modal-footer"},Rt=["disabled"],Ut=["disabled"],Et={key:0,class:"spinner-border spinner-border-sm",role:"status"},Gt={data(){return{modal:null,isLoading:!1}},props:{order:{type:Object,required:!0}},expose:["openModal"],mounted(){this.modal=new C(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{...M(G,["delOrder"]),openModal(){this.modal.show()},onSubmit(){this.isLoading=!0;const{id:o}=this.order;this.delOrder(o).then(s=>{this.modal.hide(),this.isLoading=!1})}}},L=Object.assign(Gt,{__name:"DeleteOrderModal",setup(o){return(s,n)=>{var c,e,h,d,p,g,$;return r(),m("div",wt,[t("div",St,[t("div",Ct,[t("div",Dt,[xt,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,Lt)]),t("div",Ot,[i(" 您確認要刪除報名此揪團活動，系統將會釋出您名額給其他潛友報名？ "),t("ul",At,[t("li",Tt,[jt,t("h1",Vt,a((c=o.order.activity)==null?void 0:c.title),1)]),t("li",Nt,[Bt,t("span",Ft,a((h=(e=o.order.activity)==null?void 0:e.location)==null?void 0:h.name),1)]),t("li",Pt,[qt,t("span",zt,a(`${l(u)((p=(d=o.order)==null?void 0:d.activity)==null?void 0:p.startDate)} ~ ${l(u)(($=(g=o.order)==null?void 0:g.activity)==null?void 0:$.endDate)}`),1)])])]),t("div",It,[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal",disabled:s.isLoading},"取消",8,Rt),t("button",{type:"button",class:"btn btn-danger btn-custom-rectangle",disabled:s.isLoading,onClick:n[0]||(n[0]=(...O)=>s.onSubmit&&s.onSubmit(...O))},[s.isLoading?(r(),m("span",Et)):y("",!0),i(" 刪除 ")],8,Ut)])])])],512)}}});const Ht={class:"py-3"},Jt={class:"row g-3 align-items-sm-center"},Kt={class:"col-md-6 col-xl-4 col-xxl-3 d-flex align-items-center"},Qt={class:"custom-rectangle-img custom-rectangle border-card-border-width border flex-shrink-0"},Wt=["src","alt"],Xt={class:"ms-2"},Yt={class:"fw-bold h6 mb-1 text-primary text-truncate-row-2"},Zt={class:"fs-7 mb-0 text-truncate"},ts={class:"col-md-6 col-xl-3 col-xxl d-flex flex-column justify-content-sm-center align-items-start"},ss=t("small",{class:"order-md-last opacity-80"},"活動日期",-1),os={class:"font-barlow"},es={class:"col-6 col-xl col-xxl-2 d-flex flex-column justify-content-sm-center align-items-start"},as=t("small",{class:"order-md-last opacity-80"},"主揪人",-1),is={class:"font-barlow"},ns={class:"col-6 col-xl col-xxl-2 d-flex flex-column justify-content-sm-center align-items-start"},ls=t("small",{class:"order-md-last opacity-80"},"活動狀態",-1),cs={class:"col-xl-2"},ds={class:"row gx-2 align-items-center"},rs={class:"col-auto"},ms={class:"col-auto"},hs={class:"col-auto"},_s=["onClick","disabled"],us={class:"col-auto col-xl-12"},bs=["disabled","onClick"],ys={class:"border-top px-3 pt-2 opacity-80"},vs={class:"row gx-2 gx-md-3 align-items-center list-unstyled mb-0"},ps={class:"col-md"},gs={class:"me-1 font-barlow"},$s={class:"me-1 font-barlow"},fs={class:"col-auto"},Ms={class:"me-1 font-barlow"},ks={class:"col-auto"},ws={class:"me-1 font-barlow"},Ss={class:"col-auto"},Cs={class:"me-1 font-barlow"},Ds={data(){return{filterMyOrders:[],currentActivity:{},currentOrder:{}}},components:{SearchListBar:w,CommentModal:x,DeleteOrderModal:L,NoData:D},computed:{...T(k,["myOrders"])},watch:{myOrders(){this.filterMyOrders=this.myOrders}},mounted(){this.filterMyOrders=this.myOrders},methods:{getActivityStatusTotal(o){return this.filterMyOrders.reduce((s,n)=>{const{activity:c}=n;return c.activityStatus===o&&s++,s},0)},onSubmit(o){const{keyword:s,startDate:n,endDate:c}=o;this.filterMyOrders=this.myOrders.filter(e=>(!s||e.activity.title.indexOf(s)>-1)&&(!n||e.activity.startDate>=n)&&(!c||c>=e.activity.endDate))},openCommentModal(o){this.currentActivity={...o},this.$refs.childCommentModal.openModal()},openDeleteOrderModal(o){this.currentOrder={...o},this.$refs.childDeleteOrderModal.openModal()}}},Us=Object.assign(Ds,{__name:"MyOrdersView",setup(o){return(s,n)=>{const c=N("router-link");return r(),m(v,null,[t("div",Ht,[_(w,{onOnSubmit:s.onSubmit,class:"pb-3"},null,8,["onOnSubmit"]),s.filterMyOrders.length?(r(!0),m(v,{key:0},j(s.filterMyOrders,(e,h)=>(r(),m("div",{class:b(["p-3",{"bg-lightPrimary bg-opacity-10":(h+1)%2}]),key:e.id},[t("div",Jt,[t("div",Kt,[t("div",Qt,[t("img",{src:l(F)(e.activity.imgs).img,class:"custom-rectangle img-cover",alt:e.activity.title},null,8,Wt)]),t("div",Xt,[t("h2",Yt,a(e.activity.title),1),t("h3",Zt,a(e.activity.location.name),1)])]),t("div",ts,[ss,t("span",os,a(`${l(u)(e.activity.startDate)} ~ ${l(u)(e.activity.endDate)}`),1)]),t("div",es,[as,t("span",is,a(e.activity.user.name),1)]),t("div",ns,[ls,t("span",{class:b({"text-danger":e.activity.activityStatus===0,"opacity-50":e.activity.activityStatus===3})},a(l(B)(e.activity.activityStatus)),3)]),t("div",cs,[t("div",ds,[t("div",rs,[_(c,{to:`/activity/${e.activity.id}`,class:"btn btn-link btn-sm border-0 p-0"},{default:f(()=>[i("詳情")]),_:2},1032,["to"])]),t("div",ms,[_(c,{to:`/activity/${e.activity.id}#messaget`,class:"btn btn-link btn-sm border-0 p-0"},{default:f(()=>[i("留言")]),_:2},1032,["to"])]),t("div",hs,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",onClick:d=>s.openCommentModal(e.activity),disabled:e.activity.activityStatus===0||e.activity.activityStatus===1},[i(" 評論"),e.activity.comment?(r(),m(v,{key:0},[i("(1)")],64)):y("",!0)],8,_s)]),t("div",us,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",disabled:e.activity.orderStatus===3||e.activity.orderStatus===0,onClick:d=>s.openDeleteOrderModal(e)},"刪除報名",8,bs)])])])])],2))),128)):(r(),V(D,{key:1,class:"pt-4 pb-5"})),t("div",ys,[t("ul",vs,[t("li",ps,[i("總計："),t("strong",gs,a(s.filterMyOrders.length),1),i("筆")]),t("li",{class:b(["col-auto ms-md-auto",{"text-danger":s.getActivityStatusTotal(0)}])},[i("系統中止："),t("strong",$s,a(s.getActivityStatusTotal(0)),1),i("筆")],2),t("li",fs,[i("未開始："),t("strong",Ms,a(s.getActivityStatusTotal(1)),1),i("筆")]),t("li",ks,[i("進行中："),t("strong",ws,a(s.getActivityStatusTotal(2)),1),i("筆")]),t("li",Ss,[i("已結束："),t("strong",Cs,a(s.getActivityStatusTotal(3)),1),i("筆")])])])]),_(x,{ref:"childCommentModal",activity:s.currentActivity},null,8,["activity"]),_(L,{ref:"childDeleteOrderModal",order:s.currentOrder},null,8,["order"])],64)}}});export{Us as default};
