import{i as x,a as w,_ as M,o as n,c,d as t,as as i,bf as a,ao as A,r as u,b as h,w as y,F as k,b3 as O,aO as g,m as C,an as T}from"./dateFormat-6766bd6f.js";import{M as S}from"./MemberStore-6585b4c4.js";import{a as N,o as B}from"./statusTextFormat-746565ff.js";import{g as j}from"./ActivityStore-7cef511e.js";import{S as U}from"./SearchListBar-0e82470f.js";import{M as L}from"./bootstrap.esm-e2f1acc9.js";import{l as V}from"./loading-3e2a3ab2.js";import{O as P}from"./OrderStore-4de81e78.js";import{U as z}from"./UserMugShot-c24cc398.js";import{N as R}from"./NoData-0eb11de5.js";import"./axiosBase-91228d64.js";import"./vee-validate.esm-8ceb177b.js";import"./formSchema-19c1282a.js";import"./VueStarRating.common-0e75196f.js";import"./vue.runtime.esm-bundler-2834e5db.js";import"./runtime-dom.esm-bundler-82de7fb5.js";const q={data(){return{dateFormat:x,modal:null,isLoading:!1}},props:{activity:{type:Object,required:!0}},expose:["openModal"],mounted(){this.modal=new L(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{...w(S,["delActivity"]),openModal(){this.modal.show()},onSubmit(){this.isLoading=!0;const{id:e}=this.activity;this.delActivity(e).then(l=>{this.modal.hide(),this.isLoading=!1})}}},E={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},W={class:"modal-dialog"},G={class:"modal-content"},H={class:"modal-header"},J=t("h5",{class:"modal-title"},"刪除揪團活動",-1),K=["disabled"],Q={class:"modal-body"},X={class:"list-unstyled lh-sm mb-0"},Y={class:"mt-2"},Z=t("small",{class:"opacity-75"},"活動名稱",-1),tt={class:"fw-bold fs-5 text-danger"},st={class:"mt-2"},ot=t("small",{class:"opacity-75"},"活動地點",-1),et={class:"d-block"},it={class:"mt-2"},at=t("small",{class:"opacity-75"},"活動日期",-1),lt={class:"d-block font-barlow"},nt={class:"modal-footer"},dt=["disabled"],ct=["disabled"],rt={key:0,class:"spinner-border spinner-border-sm",role:"status"};function mt(e,l,d,b,s,r){var p,m;return n(),c("div",E,[t("div",W,[t("div",G,[t("div",H,[i(a(d.activity.id)+" ",1),J,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,K)]),t("div",Q,[i(" 您確認要永久刪除此揪團活動，刪除後將無法復原？ "),t("ul",X,[t("li",Y,[Z,t("h1",tt,a((p=d.activity)==null?void 0:p.title),1)]),t("li",st,[ot,t("span",et,a((m=d.activity.location)==null?void 0:m.name),1)]),t("li",it,[at,t("span",lt,a(`${s.dateFormat(d.activity.startDate)} ~ ${s.dateFormat(d.activity.endDate)}`),1)])])]),t("div",nt,[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal",disabled:s.isLoading},"取消",8,dt),t("button",{type:"button",class:"btn btn-danger btn-custom-rectangle",disabled:s.isLoading,onClick:l[0]||(l[0]=(..._)=>r.onSubmit&&r.onSubmit(..._))},[s.isLoading?(n(),c("span",rt)):A("",!0),i(" 刪除 ")],8,ct)])])])],512)}const _t=M(q,[["render",mt]]),ht={data(){return{dateFormat:x,loadingImg:V,modal:null,violation:{},isLoading:!0}},props:["violationId"],expose:["openModal"],watch:{violationId(){this.fetchData()}},mounted(){this.modal=new L(this.$refs.modal,{keyboard:!1}),this.fetchData()},methods:{...w(S,["getViolation"]),fetchData(){this.violation={},this.violationId&&this.getViolation(this.violationId).then(e=>{this.violation=e,this.isLoading=!1})},openModal(){this.modal.show()}}},ut={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},bt={class:"modal-dialog"},pt={class:"modal-content"},gt=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"違規說明"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),yt={class:"modal-body"},vt={key:0,class:"py-3"},ft=["src"],xt=t("p",{class:"font-barlow text-uppercase mb-0 text-center opacity-80 ps-3"},"loading...",-1),Mt={key:1,class:"list-unstyled lh-sm mb-0"},$t=t("small",{class:"opacity-75"},"活動名稱",-1),kt={class:"fs-6"},wt={class:"mt-2"},St=t("small",{class:"opacity-75"},"違規原因",-1),Lt={class:"fw-bold fs-5 text-danger"},Dt=t("li",{class:"mt-2"},[t("small",{class:"opacity-75"},"懲處內容"),t("span",{class:"d-block text-danger"},"該揪團活動系統強迫下架")],-1),It={class:"mt-2"},Ot=t("small",{class:"opacity-75"},"舉發時間",-1),Vt={class:"d-block font-barlow"},Ft=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal"},"關閉")],-1);function At(e,l,d,b,s,r){var m;const p=u("VueLoading");return n(),c("div",ut,[t("div",bt,[t("div",pt,[gt,t("div",yt,[s.isLoading?(n(),c("div",vt,[h(p,{active:s.isLoading,"onUpdate:active":l[0]||(l[0]=_=>s.isLoading=_),"background-color":"#083d63",opacity:.85,"is-full-page":!1,class:"position-relative"},{default:y(()=>[t("img",{src:s.loadingImg,class:"loading-img",style:{width:"100px"},alt:"loading"},null,8,ft),xt]),_:1},8,["active","opacity"])])):(n(),c("ul",Mt,[t("li",null,[$t,t("h1",kt,a((m=s.violation.activity)==null?void 0:m.title),1)]),t("li",wt,[St,t("h1",Lt,a(s.violation.reason),1)]),Dt,t("li",It,[Ot,t("span",Vt,a(s.dateFormat(s.violation.creationDate)),1)])]))]),Ft])])],512)}const Ct=M(ht,[["render",At]]),Tt={data(){return{dateFormat:x,loadingImg:V,modal:null,orders:[],isLoading:!0}},props:["activityId"],expose:["openModal"],watch:{activityId(){this.fetchData()}},components:{UserMugShot:z},mounted(){this.modal=new L(this.$refs.modal,{keyboard:!1}),this.fetchData()},methods:{...w(P,["getSearchOrdersForActivityId"]),fetchData(){this.orders=[],this.activityId&&this.getSearchOrdersForActivityId(this.activityId).then(e=>{this.orders=e,this.isLoading=!1})},openModal(){this.modal.show()}}},Nt={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},Bt={class:"modal-dialog"},jt={class:"modal-content"},Ut=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"報名總覽"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Pt={class:"modal-body py-0"},zt={key:0,class:"py-3"},Rt=["src"],qt=t("p",{class:"font-barlow text-uppercase mb-0 text-center opacity-80 ps-3"},"loading...",-1),Et={key:1,class:"list-group list-group-flush"},Wt={class:"bg-lightPrimary bg-opacity-10 p-2"},Gt={class:"row align-items-center"},Ht={class:"col"},Jt={class:"col-auto font-barlow"},Kt=t("ul",{class:"list-unstyled opacity-80 mt-2 px-2"},[t("li",null,[i("證照等級"),t("strong",{class:"ms-2"},"AOW")]),t("li",null,[i("需有高氧證照"),t("strong",{class:"ms-2"},"是")]),t("li",null,[i("潛水支數"),t("strong",{class:"ms-2"},"25+")])],-1),Qt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal"},"關閉")],-1);function Xt(e,l,d,b,s,r){const p=u("VueLoading"),m=u("UserMugShot");return n(),c("div",Nt,[t("div",Bt,[t("div",jt,[Ut,t("div",Pt,[s.isLoading?(n(),c("div",zt,[h(p,{active:s.isLoading,"onUpdate:active":l[0]||(l[0]=_=>s.isLoading=_),"background-color":"#083d63",opacity:.85,"is-full-page":!1,class:"position-relative"},{default:y(()=>[t("img",{src:s.loadingImg,class:"loading-img",style:{width:"100px"},alt:"loading"},null,8,Rt),qt]),_:1},8,["active","opacity"])])):(n(),c("ul",Et,[(n(!0),c(k,null,O(s.orders,(_,$)=>{var v,f;return n(),c("li",{class:g(["list-group-item px-0",{"pt-0":$}]),key:_.id},[t("div",Wt,[t("div",Gt,[t("div",Ht,[h(m,{img:(v=_.user)==null?void 0:v.img,name:(f=_.user)==null?void 0:f.name,widthSize:30},null,8,["img","name"])]),t("div",Jt,a(s.dateFormat(_.updateDate,["date","time"])),1)])]),Kt],2)}),128))]))]),Qt])])],512)}const Yt=M(Tt,[["render",Xt]]);const Zt={data(){return{dateFormat:x,activityStatusTextFormat:N,orderStatusTextFormat:B,getMainImg:j,filterMyActivities:[],currentActivity:{},currentActivityId:null,currentViolationId:null}},components:{SearchListBar:U,DeleteActivityModal:_t,ViolationModal:Ct,OrderModal:Yt,NoData:R},computed:{...C(S,["myActivities"]),fullActivitiesTotal(){return this.filterMyActivities.reduce((e,l)=>{const{maxOrderTotal:d,orders:b}=l;return d===b.length&&e++,e},0)}},watch:{myActivities(){this.filterMyActivities=this.myActivities}},mounted(){this.filterMyActivities=this.myActivities},methods:{getOrderStatusTotal(e){return this.filterMyActivities.reduce((l,d)=>(d.orderStatus===e&&l++,l),0)},onSubmit(e){const{keyword:l,startDate:d,endDate:b}=e;this.filterMyActivities=this.myActivities.filter(s=>(!l||s.title.indexOf(l)>-1)&&(!d||s.startDate>=d)&&(!b||b>=s.endDate))},openViolationModal(e){this.currentViolationId=e,this.$refs.childViolationModal.openModal()},openOrderModal(e){this.currentActivityId=e,this.$refs.childOrderModal.openModal()},openDelActivityModal(e){this.currentActivity={...e},this.$refs.childDeleteActivityModal.openModal()}}},ts={class:"py-3"},ss={class:"row g-2 pb-3"},os={class:"col-md"},es={class:"col-md-auto"},is={class:"row g-3 align-items-sm-center"},as={class:"col-md-6 col-xl-4 col-xxl-3 d-flex align-items-center"},ls={class:"custom-rectangle-img custom-rectangle border-card-border-width border flex-shrink-0"},ns=["src","alt"],ds={class:"ms-2"},cs={class:"fw-bold h6 mb-1 text-primary text-truncate-row-2"},rs={class:"fs-7 mb-0 text-truncate"},ms={class:"col-sm-6 col-xl-3 d-flex flex-column justify-content-sm-center align-items-start"},_s=t("small",{class:"order-md-last opacity-80"},"活動日期",-1),hs={class:"font-barlow"},us={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},bs=t("small",{class:"order-md-last opacity-80"},"報名人數",-1),ps={class:"font-barlow"},gs={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},ys=t("small",{class:"order-md-last opacity-80"},"揪團狀態",-1),vs={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},fs=t("small",{class:"order-md-last opacity-80"},"活動狀態",-1),xs={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},Ms=t("small",{class:"order-md-last opacity-80"},"更新時間",-1),$s={class:"font-barlow"},ks={class:"col-xxl-2"},ws={key:0,class:"row gx-2 align-items-center"},Ss={class:"col-auto"},Ls={class:"col-auto"},Ds={class:"col-auto"},Is=["disabled","onClick"],Os={class:"col-auto"},Vs={class:"col-auto"},Fs=["disabled","onClick"],As=["onClick"],Cs={class:"border-top px-3 pt-2 opacity-80"},Ts={class:"row gx-2 gx-md-3 align-items-center list-unstyled mb-0"},Ns={class:"col-md"},Bs={class:"me-1 font-barlow"},js={class:"me-1 font-barlow"},Us={class:"col-auto"},Ps={class:"me-1 font-barlow"},zs={class:"col-auto"},Rs={class:"me-1 font-barlow"},qs={class:"col-auto"},Es={class:"me-1 font-barlow"};function Ws(e,l,d,b,s,r){const p=u("SearchListBar"),m=u("RouterLink"),_=u("NoData"),$=u("ViolationModal"),v=u("OrderModal"),f=u("DeleteActivityModal");return n(),c(k,null,[t("div",ts,[t("div",ss,[t("div",os,[h(p,{onOnSubmit:r.onSubmit},null,8,["onOnSubmit"])]),t("div",es,[h(m,{class:"btn btn-primary btn-custom-rectangle",to:"/addActivity",role:"button"},{default:y(()=>[i("新增揪團")]),_:1})])]),s.filterMyActivities.length?(n(!0),c(k,{key:0},O(s.filterMyActivities,(o,F)=>(n(),c("div",{class:g(["p-3",{"bg-lightPrimary bg-opacity-10":(F+1)%2}]),key:o.id},[t("div",is,[t("div",as,[t("div",ls,[t("img",{src:s.getMainImg(o.imgs).img,class:"custom-rectangle img-cover",alt:o.title},null,8,ns)]),t("div",ds,[t("h2",cs,a(o.title),1),t("h3",rs,a(o.location.name),1)])]),t("div",ms,[_s,t("span",hs,a(`${s.dateFormat(o.startDate)} ~ ${s.dateFormat(o.endDate)}`),1)]),t("div",us,[bs,t("span",ps,[t("strong",null,a(o.orders.length),1),i("/"+a(o.maxOrderTotal),1)])]),t("div",gs,[ys,t("span",{class:g({"text-danger":o.orderStatus===0,"opacity-50":o.orderStatus===2})},a(s.orderStatusTextFormat(o.orderStatus)),3)]),t("div",vs,[fs,t("span",{class:g({"text-danger":o.activityStatus===0,"opacity-50":o.activityStatus===3})},a(s.activityStatusTextFormat(o.activityStatus)),3)]),t("div",xs,[Ms,t("span",$s,a(s.dateFormat(o.updateDate,["date","time"])),1)]),t("div",ks,[o.activityStatus!==0?(n(),c("div",ws,[t("div",Ss,[h(m,{to:`/editActivity/${o.id}`,class:g(["btn btn-link btn-sm border-0 p-0",{disabled:o.orders.length}])},{default:y(()=>[i("編輯")]),_:2},1032,["to","class"])]),t("div",Ls,[h(m,{to:`/activity/${o.id}`,class:"btn btn-link btn-sm border-0 p-0"},{default:y(()=>[i("查看")]),_:2},1032,["to"])]),t("div",Ds,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",disabled:!o.orders.length,onClick:D=>r.openOrderModal(o.id)}," 報名總覽 ",8,Is)]),t("div",Os,[h(m,{to:`/activity/${o.id}#messaget`,class:"btn btn-link btn-sm border-0 p-0"},{default:y(()=>[i("留言")]),_:2},1032,["to"])]),t("div",Vs,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",disabled:o.orderStatus===3,onClick:D=>r.openDelActivityModal(o)}," 刪除 ",8,Fs)])])):(n(),c("button",{key:1,type:"button",class:"btn btn-link btn-sm border-0 p-0",onClick:D=>{var I;return r.openViolationModal((I=o.violations[0])==null?void 0:I.id)}}," 違規原因 ",8,As))])])],2))),128)):(n(),T(_,{key:1,class:"pt-4 pb-5"})),t("div",Cs,[t("ul",Ts,[t("li",Ns,[i(" 總計："),t("strong",Bs,a(s.filterMyActivities.length),1),i("筆 ")]),t("li",{class:g(["col-auto ms-md-auto",{"text-danger":r.getOrderStatusTotal(0)}])},[i(" 系統中止："),t("strong",js,a(r.getOrderStatusTotal(0)),1),i("筆 ")],2),t("li",Us,[i(" 已額滿："),t("strong",Ps,a(r.fullActivitiesTotal),1),i("筆 ")]),t("li",zs,[i(" 進行中："),t("strong",Rs,a(r.getOrderStatusTotal(2)),1),i("筆 ")]),t("li",qs,[i(" 已截止："),t("strong",Es,a(r.getOrderStatusTotal(3)),1),i("筆 ")])])])]),h($,{ref:"childViolationModal",violationId:s.currentViolationId},null,8,["violationId"]),h(v,{ref:"childOrderModal",activityId:s.currentActivityId},null,8,["activityId"]),h(f,{ref:"childDeleteActivityModal",activity:s.currentActivity},null,8,["activity"])],64)}const co=M(Zt,[["render",Ws]]);export{co as default};
