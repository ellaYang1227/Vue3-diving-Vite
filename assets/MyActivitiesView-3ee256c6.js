import{bw as v,o as d,c,b as t,ap as e,bd as i,u as r,g as h,al as V,r as f,a as m,w as b,F as y,b1 as k,aL as u,m as C,ak as A}from"./dateFormat-6fb55f48.js";import{o as T,a as j}from"./statusTextFormat-746565ff.js";import{g as F}from"./ActivityStore-7b0f0073.js";import{M as $}from"./MemberStore-b4dff722.js";import{_ as w}from"./SearchListBar-f2b8bc2f.js";import{M}from"./bootstrap.esm-e2f1acc9.js";import{l as S}from"./loading-3e2a3ab2.js";import{O as N}from"./OrderStore-5c2ede6a.js";import{_ as x}from"./UserMugShot-08c8e94a.js";import{N as L}from"./NoData-9de1db4c.js";import"./axiosBase-7e3cd247.js";import"./formSchema-ec93e38c.js";import"./vee-validate.esm-3e833f9c.js";import"./VueStarRating.common-31683828.js";import"./vue.runtime.esm-bundler-d1805eff.js";import"./runtime-dom.esm-bundler-7a3bf3e3.js";import"./_plugin-vue_export-helper-c27b6911.js";const B={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},P={class:"modal-dialog"},U={class:"modal-content"},z={class:"modal-header"},q=t("h5",{class:"modal-title"},"刪除揪團活動",-1),E=["disabled"],W={class:"modal-body"},G={class:"list-unstyled lh-sm mb-0"},H={class:"mt-2"},J=t("small",{class:"opacity-75"},"活動名稱",-1),K={class:"fw-bold fs-5 text-danger"},Q={class:"mt-2"},R=t("small",{class:"opacity-75"},"活動地點",-1),X={class:"d-block"},Y={class:"mt-2"},Z=t("small",{class:"opacity-75"},"活動日期",-1),tt={class:"d-block font-barlow"},st={class:"modal-footer"},ot=["disabled"],at=["disabled"],et={key:0,class:"spinner-border spinner-border-sm",role:"status"},it={data(){return{modal:null,isLoading:!1}},props:{activity:{type:Object,required:!0}},expose:["openModal"],mounted(){this.modal=new M(this.$refs.modal,{keyboard:!1,backdrop:"static"})},methods:{...v($,["delActivity"]),openModal(){this.modal.show()},onSubmit(){this.isLoading=!0;const{id:a}=this.activity;this.delActivity(a).then(s=>{this.modal.hide(),this.isLoading=!1})}}},O=Object.assign(it,{__name:"DeleteActivityModal",setup(a){return(s,l)=>{var n,o;return d(),c("div",B,[t("div",P,[t("div",U,[t("div",z,[e(i(a.activity.id)+" ",1),q,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:s.isLoading},null,8,E)]),t("div",W,[e(" 您確認要永久刪除此揪團活動，刪除後將無法復原？ "),t("ul",G,[t("li",H,[J,t("h1",K,i((n=a.activity)==null?void 0:n.title),1)]),t("li",Q,[R,t("span",X,i((o=a.activity.location)==null?void 0:o.name),1)]),t("li",Y,[Z,t("span",tt,i(`${r(h)(a.activity.startDate)} ~ ${r(h)(a.activity.endDate)}`),1)])])]),t("div",st,[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal",disabled:s.isLoading},"取消",8,ot),t("button",{type:"button",class:"btn btn-danger btn-custom-rectangle",disabled:s.isLoading,onClick:l[0]||(l[0]=(..._)=>s.onSubmit&&s.onSubmit(..._))},[s.isLoading?(d(),c("span",et)):V("",!0),e(" 刪除 ")],8,at)])])])],512)}}}),lt={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},nt={class:"modal-dialog"},dt={class:"modal-content"},ct=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"違規說明"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),rt={class:"modal-body"},mt={key:0,class:"py-3"},_t=["src"],ht=t("p",{class:"font-barlow text-uppercase mb-0 text-center opacity-80 ps-3"},"loading...",-1),ut={key:1,class:"list-unstyled lh-sm mb-0"},bt=t("small",{class:"opacity-75"},"活動名稱",-1),pt={class:"fs-6"},gt={class:"mt-2"},yt=t("small",{class:"opacity-75"},"違規原因",-1),vt={class:"fw-bold fs-5 text-danger"},ft=t("li",{class:"mt-2"},[t("small",{class:"opacity-75"},"懲處內容"),t("span",{class:"d-block text-danger"},"該揪團活動系統強迫下架")],-1),$t={class:"mt-2"},Mt=t("small",{class:"opacity-75"},"舉發時間",-1),kt={class:"d-block font-barlow"},wt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal"},"關閉")],-1),St={data(){return{modal:null,violation:{},isLoading:!0}},props:["violationId"],expose:["openModal"],watch:{violationId(){this.fetchData()}},mounted(){this.modal=new M(this.$refs.modal,{keyboard:!1}),this.fetchData()},methods:{...v($,["getViolation"]),fetchData(){this.violation={},this.violationId&&this.getViolation(this.violationId).then(a=>{this.violation=a,this.isLoading=!1})},openModal(){this.modal.show()}}},D=Object.assign(St,{__name:"ViolationModal",setup(a){return(s,l)=>{var o;const n=f("VueLoading");return d(),c("div",lt,[t("div",nt,[t("div",dt,[ct,t("div",rt,[s.isLoading?(d(),c("div",mt,[m(n,{active:s.isLoading,"onUpdate:active":l[0]||(l[0]=_=>s.isLoading=_),"background-color":"#083d63",opacity:.85,"is-full-page":!1,class:"position-relative"},{default:b(()=>[t("img",{src:r(S),class:"loading-img",style:{width:"100px"}},null,8,_t),ht]),_:1},8,["active","opacity"])])):(d(),c("ul",ut,[t("li",null,[bt,t("h1",pt,i((o=s.violation.activity)==null?void 0:o.title),1)]),t("li",gt,[yt,t("h1",vt,i(s.violation.reason),1)]),ft,t("li",$t,[Mt,t("span",kt,i(r(h)(s.violation.creationDate)),1)])]))]),wt])])],512)}}}),xt={class:"modal fade",ref:"modal","aria-labelledby":"commentModalLabel","aria-hidden":"true"},Lt={class:"modal-dialog"},Ot={class:"modal-content"},Dt=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"報名總覽"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),It={class:"modal-body py-0"},Vt={key:0,class:"py-3"},Ct=["src"],At=t("p",{class:"font-barlow text-uppercase mb-0 text-center opacity-80 ps-3"},"loading...",-1),Tt={key:1,class:"list-group list-group-flush"},jt={class:"bg-lightPrimary bg-opacity-10 p-2"},Ft={class:"row align-items-center"},Nt={class:"col"},Bt={class:"col-auto font-barlow"},Pt=t("ul",{class:"list-unstyled opacity-80 mt-2 px-2"},[t("li",null,[e("證照等級"),t("strong",{class:"ms-2"},"AOW")]),t("li",null,[e("需有高氧證照"),t("strong",{class:"ms-2"},"是")]),t("li",null,[e("潛水支數"),t("strong",{class:"ms-2"},"25+")])],-1),Ut=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-lightPrimary rounded-0","data-bs-dismiss":"modal"},"關閉")],-1),zt={data(){return{modal:null,orders:[],isLoading:!0}},props:["activityId"],expose:["openModal"],watch:{activityId(){this.fetchData()}},components:{UserMugShot:x},mounted(){this.modal=new M(this.$refs.modal,{keyboard:!1}),this.fetchData()},methods:{...v(N,["getSearchOrdersForActivityId"]),fetchData(){this.orders=[],this.activityId&&this.getSearchOrdersForActivityId(this.activityId).then(a=>{this.orders=a,this.isLoading=!1})},openModal(){this.modal.show()}}},I=Object.assign(zt,{__name:"OrderModal",setup(a){return(s,l)=>{const n=f("VueLoading");return d(),c("div",xt,[t("div",Lt,[t("div",Ot,[Dt,t("div",It,[s.isLoading?(d(),c("div",Vt,[m(n,{active:s.isLoading,"onUpdate:active":l[0]||(l[0]=o=>s.isLoading=o),"background-color":"#083d63",opacity:.85,"is-full-page":!1,class:"position-relative"},{default:b(()=>[t("img",{src:r(S),class:"loading-img",style:{width:"100px"}},null,8,Ct),At]),_:1},8,["active","opacity"])])):(d(),c("ul",Tt,[(d(!0),c(y,null,k(s.orders,(o,_)=>{var p,g;return d(),c("li",{class:u(["list-group-item px-0",{"pt-0":_}]),key:o.id},[t("div",jt,[t("div",Ft,[t("div",Nt,[m(x,{img:(p=o.user)==null?void 0:p.img,name:(g=o.user)==null?void 0:g.name,widthSize:30},null,8,["img","name"])]),t("div",Bt,i(r(h)(o.updateDate,["date","time"])),1)])]),Pt],2)}),128))]))]),Ut])])],512)}}});const qt={class:"py-3"},Et={class:"row g-2 pb-3"},Wt={class:"col-md"},Gt={class:"col-md-auto"},Ht={class:"row g-3 align-items-sm-center"},Jt={class:"col-md-6 col-xl-4 col-xxl-3 d-flex align-items-center"},Kt={class:"custom-rectangle-img custom-rectangle border-card-border-width border flex-shrink-0"},Qt=["src","alt"],Rt={class:"ms-2"},Xt={class:"fw-bold h6 mb-1 text-primary text-truncate-row-2"},Yt={class:"fs-7 mb-0 text-truncate"},Zt={class:"col-sm-6 col-xl-3 d-flex flex-column justify-content-sm-center align-items-start"},ts=t("small",{class:"order-md-last opacity-80"},"活動日期",-1),ss={class:"font-barlow"},os={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},as=t("small",{class:"order-md-last opacity-80"},"報名人數",-1),es={class:"font-barlow"},is={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},ls=t("small",{class:"order-md-last opacity-80"},"揪團狀態",-1),ns={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},ds=t("small",{class:"order-md-last opacity-80"},"活動狀態",-1),cs={class:"col-6 col-xl d-flex flex-column justify-content-sm-center align-items-start"},rs=t("small",{class:"order-md-last opacity-80"},"更新時間",-1),ms={class:"font-barlow"},_s={class:"col-xxl-2"},hs={key:0,class:"row gx-2 align-items-center"},us={class:"col-auto"},bs={class:"col-auto"},ps={class:"col-auto"},gs=["disabled","onClick"],ys={class:"col-auto"},vs={class:"col-auto"},fs=["disabled","onClick"],$s=["onClick"],Ms={class:"border-top px-3 pt-2 opacity-80"},ks={class:"row gx-2 gx-md-3 align-items-center list-unstyled mb-0"},ws={class:"col-md"},Ss={class:"me-1 font-barlow"},xs={class:"me-1 font-barlow"},Ls={class:"col-auto"},Os={class:"me-1 font-barlow"},Ds={class:"col-auto"},Is={class:"me-1 font-barlow"},Vs={class:"col-auto"},Cs={class:"me-1 font-barlow"},As={data(){return{filterMyActivities:[],currentActivity:{},currentActivityId:null,currentViolationId:null}},components:{SearchListBar:w,DeleteActivityModal:O,ViolationModal:D,OrderModal:I,NoData:L},computed:{...C($,["myActivities"]),fullActivitiesTotal(){return this.filterMyActivities.reduce((a,s)=>{const{maxOrderTotal:l,orders:n}=s;return l===n.length&&a++,a},0)}},watch:{myActivities(){this.filterMyActivities=this.myActivities}},mounted(){this.filterMyActivities=this.myActivities},methods:{getOrderStatusTotal(a){return this.filterMyActivities.reduce((s,l)=>(l.orderStatus===a&&s++,s),0)},onSubmit(a){const{keyword:s,startDate:l,endDate:n}=a;this.filterMyActivities=this.myActivities.filter(o=>(!s||o.title.indexOf(s)>-1)&&(!l||o.startDate>=l)&&(!n||n>=o.endDate))},openViolationModal(a){this.currentViolationId=a,this.$refs.childViolationModal.openModal()},openOrderModal(a){this.currentActivityId=a,this.$refs.childOrderModal.openModal()},openDelActivityModal(a){this.currentActivity={...a},this.$refs.childDeleteActivityModal.openModal()}}},Xs=Object.assign(As,{__name:"MyActivitiesView",setup(a){return(s,l)=>{const n=f("router-link");return d(),c(y,null,[t("div",qt,[t("div",Et,[t("div",Wt,[m(w,{onOnSubmit:s.onSubmit},null,8,["onOnSubmit"])]),t("div",Gt,[m(n,{class:"btn btn-primary btn-custom-rectangle",to:"/addActivity",role:"button"},{default:b(()=>[e("新增揪團")]),_:1})])]),s.filterMyActivities.length?(d(!0),c(y,{key:0},k(s.filterMyActivities,(o,_)=>(d(),c("div",{class:u(["p-3",{"bg-lightPrimary bg-opacity-10":(_+1)%2}]),key:o.id},[t("div",Ht,[t("div",Jt,[t("div",Kt,[t("img",{src:r(F)(o.imgs).img,class:"custom-rectangle img-cover",alt:o.title},null,8,Qt)]),t("div",Rt,[t("h2",Xt,i(o.title),1),t("h3",Yt,i(o.location.name),1)])]),t("div",Zt,[ts,t("span",ss,i(`${r(h)(o.startDate)} ~ ${r(h)(o.endDate)}`),1)]),t("div",os,[as,t("span",es,[t("strong",null,i(o.orders.length),1),e("/"+i(o.maxOrderTotal),1)])]),t("div",is,[ls,t("span",{class:u({"text-danger":o.orderStatus===0,"opacity-50":o.orderStatus===2})},i(r(T)(o.orderStatus)),3)]),t("div",ns,[ds,t("span",{class:u({"text-danger":o.activityStatus===0,"opacity-50":o.activityStatus===3})},i(r(j)(o.activityStatus)),3)]),t("div",cs,[rs,t("span",ms,i(r(h)(o.updateDate,["date","time"])),1)]),t("div",_s,[o.activityStatus!==0?(d(),c("div",hs,[t("div",us,[m(n,{to:`/editActivity/${o.id}`,class:u(["btn btn-link btn-sm border-0 p-0",{disabled:o.orders.length}])},{default:b(()=>[e("編輯")]),_:2},1032,["to","class"])]),t("div",bs,[m(n,{to:`/activity/${o.id}`,class:"btn btn-link btn-sm border-0 p-0"},{default:b(()=>[e("查看")]),_:2},1032,["to"])]),t("div",ps,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",disabled:!o.orders.length,onClick:p=>s.openOrderModal(o.id)},"報名總覽",8,gs)]),t("div",ys,[m(n,{to:`/activity/${o.id}#messaget`,class:"btn btn-link btn-sm border-0 p-0"},{default:b(()=>[e("留言")]),_:2},1032,["to"])]),t("div",vs,[t("button",{type:"button",class:"btn btn-link btn-sm border-0 p-0",disabled:o.orderStatus===3,onClick:p=>s.openDelActivityModal(o)},"刪除",8,fs)])])):(d(),c("button",{key:1,type:"button",class:"btn btn-link btn-sm border-0 p-0",onClick:p=>{var g;return s.openViolationModal((g=o.violations[0])==null?void 0:g.id)}},"違規原因",8,$s))])])],2))),128)):(d(),A(L,{key:1,class:"pt-4 pb-5"})),t("div",Ms,[t("ul",ks,[t("li",ws,[e("總計："),t("strong",Ss,i(s.filterMyActivities.length),1),e("筆")]),t("li",{class:u(["col-auto ms-md-auto",{"text-danger":s.getOrderStatusTotal(0)}])},[e("系統中止："),t("strong",xs,i(s.getOrderStatusTotal(0)),1),e("筆")],2),t("li",Ls,[e("已額滿："),t("strong",Os,i(s.fullActivitiesTotal),1),e("筆")]),t("li",Ds,[e("進行中："),t("strong",Is,i(s.getOrderStatusTotal(2)),1),e("筆")]),t("li",Vs,[e("已截止："),t("strong",Cs,i(s.getOrderStatusTotal(3)),1),e("筆")])])])]),m(D,{ref:"childViolationModal",violationId:s.currentViolationId},null,8,["violationId"]),m(I,{ref:"childOrderModal",activityId:s.currentActivityId},null,8,["activityId"]),m(O,{ref:"childDeleteActivityModal",activity:s.currentActivity},null,8,["activity"])],64)}}});export{Xs as default};
